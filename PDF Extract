import pdfplumber
import pandas as pd
import re

# Function to extract tables and associated text
def extract_tables_with_text(pdf_path):
    tables_with_text = []
    with pdfplumber.open(pdf_path) as pdf:
        for page in pdf.pages:
            text = page.extract_text()
            tables = page.extract_tables()
            if text and tables:
                # Find lines starting with 23MY or 24MY
                matches = re.findall(r'^(23MY|24MY).*$', text, re.MULTILINE)
                for match in matches:
                    for table in tables:
                        tables_with_text.append((match, table))
    return tables_with_text

# Example usage
pdf_path = "path_to_your_pdf_file.pdf"
tables_with_text = extract_tables_with_text(pdf_path)

# Convert extracted tables to dataframes and save them with appropriate names
for idx, (name, table) in enumerate(tables_with_text):
    df = pd.DataFrame(table[1:], columns=table[0])  # Assuming first row is the header
    df.to_csv(f"{name}_table_{idx}.csv", index=False)
