import fitz  # PyMuPDF
import pandas as pd
import camelot

# Open the PDF file
pdf_path = "path_to_your_file.pdf"
pdf_document = fitz.open(pdf_path)

# Initialize an empty list to hold the text and table data
data = []

# Iterate through each page in the PDF
for page_num in range(len(pdf_document)):
    page = pdf_document.load_page(page_num)
    text = page.get_text("text")
    
    # Extract tables using Camelot
    tables = camelot.read_pdf(pdf_path, pages=str(page_num+1))
    
    # Find the position of each table in the text
    for i, table in enumerate(tables):
        table_df = table.df  # Convert table to DataFrame
        table_area = table._bbox  # Bounding box of the table
        text_above_table = ""
        
        # Extract text above the table
        for line in text.split('\n'):
            bbox = page.search_for(line)
            if bbox and bbox[0][3] < table_area[1]:  # Check if the line is above the table
                text_above_table += line + "\n"
        
        # Extract the last line before the table as the table name
        table_name = text_above_table.strip().split('\n')[-1]
        
        data.append((table_name, table_df))

# Convert to a dictionary of DataFrames
tables_dict = {item[0]: item[1] for item in data}

# Example of accessing a table by its name
for table_name, table_df in tables_dict.items():
    print(f"Table Name: {table_name}")
    print(table_df)
    print("\n")
