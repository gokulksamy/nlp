import fitz  # PyMuPDF
import camelot
import pandas as pd

def extract_text_and_tables(pdf_path):
    # Open the PDF file
    document = fitz.open(pdf_path)
    
    extracted_data = {}
    text_blocks = []
    current_text = ""
    
    for page_num in range(len(document)):
        page = document.load_page(page_num)
        text = page.get_text("text")
        text_blocks.extend(text.split('\n'))

        # Get tables from the current page
        tables = camelot.read_pdf(pdf_path, pages=str(page_num + 1))
        
        # Combine text blocks to form descriptions
        for block in text_blocks:
            if block.strip():  # Check if block is not empty
                current_text += block.strip() + " "
        
        if tables:
            for table in tables:
                df = table.df
                extracted_data[current_text.strip()] = df
                current_text = ""  # Reset current text for next table
    
    # Handle any remaining text if it wasn't followed by a table
    if current_text.strip():
        extracted_data[current_text.strip()] = pd.DataFrame()

    return extracted_data

# Usage example
pdf_path = 'path_to_your_pdf_file.pdf'
data = extract_text_and_tables(pdf_path)

# Display the extracted data
for description, table in data.items():
    print("Description:", description)
    print("Table:")
    print(table)
